<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://github.com/emccode/rexray/user-guide/schedulers/">
        <link rel="shortcut icon" href="../../favicon.png">
        

	<title>Schedulers - REX-Ray</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/emccode-font.css" rel="stylesheet">
        <link href="../../css/hX.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        

        <!-- scroll fix -->
        <script>
            //var shiftWindow = function() { scrollBy(0, -40) };
            //if (location.hash) shiftWindow();
            //window.addEventListener("hashchange", shiftWindow);
        </script>

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">
                <i class="fa icon-rexray-logo"></i>
                REX-Ray
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../installation/">Installation</a>
                        </li>
                    
                        <li >
                            <a href="../config/">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="../storage-providers/">Storage Providers</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Schedulers</a>
                        </li>
                    
                        <li >
                            <a href="../application/">Applications</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">User Guide <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../installation/">Installation</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../config/">Configuration</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../storage-providers/">Storage Providers</a>
                        </li>
                    
                    
                    
                        <li class="active">
                            <a href="./">Schedulers</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../application/">Applications</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../dev-guide/project-guidelines/">Project Guidelines</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/build-reference/">Build Reference</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/release-process/">Release Process</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">Developers Guide <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../../dev-guide/project-guidelines/">Project Guidelines</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../dev-guide/build-reference/">Build Reference</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../dev-guide/release-process/">Release Process</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../about/contributing/">Contributing</a>
                        </li>
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                        <li >
                            <a href="../../about/release-notes/">Release Notes</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">About <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../../about/contributing/">Contributing</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../about/release-notes/">Release Notes</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../storage-providers/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../application/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/emccode/rexray.git">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
                <li>
                    <a href="https://emccode.github.io">
                        <i class="fa icon-emccode-logo"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
        <div class="container ">
            <div class="col-md-3"><div id="sidenav" class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#schedulers">Schedulers</a></li>
        
            <li><a href="#overview">Overview</a>
            
            </li>
        
            <li><a href="#docker">Docker</a>
            
                <ul class="nav nav-stacked">
                
                <li><a href="#example-configuration">Example Configuration</a><!--
                
                <ul class="nav nav-stacked">
                    
                    <li><a href="#extra-global-parameters">Extra Global Parameters</a></li>
                    
                </ul>
                -->
                </li>
                
                <li><a href="#starting-volume-driver">Starting Volume Driver</a><!--
                -->
                </li>
                
                <li><a href="#creating-and-using-volumes">Creating and Using Volumes</a><!--
                -->
                </li>
                
                <li><a href="#extra-volume-create-options">Extra Volume Create Options</a><!--
                -->
                </li>
                
                <li><a href="#caveats">Caveats</a><!--
                -->
                </li>
                
                </ul>
            
            </li>
        
            <li><a href="#mesos">Mesos</a>
            
                <ul class="nav nav-stacked">
                
                <li><a href="#docker-containerizer-with-marathon">Docker Containerizer with Marathon</a><!--
                -->
                </li>
                
                <li><a href="#mesos-containerizer-with-marathon">Mesos Containerizer with Marathon</a><!--
                -->
                </li>
                
                </ul>
            
            </li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="schedulers">Schedulers</h1>
<p>Scheduling storage one resource at a time...</p>
<hr />
<h2 id="overview">Overview</h2>
<p>This page reviews the scheduling systems supported by <code>REX-Ray</code>.</p>
<h2 id="docker">Docker</h2>
<p><code>REX-Ray</code> has a <code>Docker Volume Driver</code> which is compatible with 1.7+.</p>
<p>It is suggested that you are running <code>Docker 1.10.2+</code> with <code>REX-Ray</code> especially
if you are sharing volumes between containers, or you want interactive
volume commands through <code>docker volume</code>.</p>
<h3 id="example-configuration">Example Configuration</h3>
<p>Below is an example <code>config.yml</code> that can be used.  The <code>volume.mount.preempt</code>
is an optional parameter here which enables any host to take control of a
volume irrespective of whether other hosts are using the volume.  If this is
set to <code>false</code> then plugins should ensure <code>safety</code> first by locking the
volume from to the current owner host. We also specify <code>docker.size</code> which will
create all new volumes at the specified size in GB.</p>
<pre><code class="yaml">rexray:
  storageDrivers:
  - virtualbox
  volume:
    mount:
      preempt: true
docker:
  size: 1
virtualbox:
  endpoint: http://yourlaptop:18083
  volumePath: /Users/youruser/VirtualBox Volumes
  controllerName: SATA
</code></pre>

<h4 id="extra-global-parameters">Extra Global Parameters</h4>
<p>These are all valid parameters that can be configured for the service.</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>docker.size</td>
<td>Size in GB</td>
</tr>
<tr>
<td>docker.iops</td>
<td>IOPS</td>
</tr>
<tr>
<td>docker.volumeType</td>
<td>Type of Volume or Storage Pool</td>
</tr>
<tr>
<td>docker.fsType</td>
<td>Type of filesystem for new volumes (ext4/xfs)</td>
</tr>
<tr>
<td>docker.availabilityZone</td>
<td>Extensible parameter per storage driver</td>
</tr>
<tr>
<td>linux.volume.rootPath</td>
<td>The path within the volume to private mount (/data)</td>
</tr>
<tr>
<td>rexray.volume.mount.preempt</td>
<td>Forcefully take control of volumes when requested</td>
</tr>
</tbody>
</table>
<h3 id="starting-volume-driver">Starting Volume Driver</h3>
<p>REX-Ray must be running as a service to serve requests from Docker. This can be
done by running <code>rexray start</code>.  Make sure you restart REX-Ray if you make
configuration changes.</p>
<pre><code>$ sudo rexray start
Starting REX-Ray...SUCESS!

  The REX-Ray daemon is now running at PID 18141. To
  shutdown the daemon execute the following command:

    sudo rexray stop
</code></pre>
<p>Following this you can now leverage volumes with Docker.</p>
<h3 id="creating-and-using-volumes">Creating and Using Volumes</h3>
<p>There are two ways to interact with volumes. You can use the <code>docker run</code>
command in combination with <code>--volume-driver</code> for new volumes, or
specify <code>-v volumeName</code> by itself for existing volumes. The <code>--volumes-from</code>
will also work when sharing existing volumes with a new container.</p>
<p>The <code>docker volume</code> sub-command
enables complete management to create, remove, and list existing volumes. All
volumes are returned from the underlying storage platform.</p>
<ol>
<li>
<p>Run containers with volumes (1.7+)</p>
<pre><code>docker run -ti --volume-driver=rexray -v test:/test busybox
</code></pre>
</li>
<li>
<p>Create volume with options (1.8+)</p>
<pre><code>docker volume create --driver=rexray --opt=size=5 --name=test
</code></pre>
</li>
</ol>
<h3 id="extra-volume-create-options">Extra Volume Create Options</h3>
<table>
<thead>
<tr>
<th>option</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>Size in GB</td>
</tr>
<tr>
<td>IOPS</td>
<td>IOPS</td>
</tr>
<tr>
<td>volumeType</td>
<td>Type of Volume or Storage Pool</td>
</tr>
<tr>
<td>volumeName</td>
<td>Create from an existing volume name</td>
</tr>
<tr>
<td>volumeID</td>
<td>Creat from an existing volume ID</td>
</tr>
<tr>
<td>snapshotName</td>
<td>Create from an existing snapshot name</td>
</tr>
<tr>
<td>snapshotID</td>
<td>Create from an existing snapshot ID</td>
</tr>
</tbody>
</table>
<h3 id="caveats">Caveats</h3>
<p>If you restart the REX-Ray instance while volumes <em>are shared between
Docker containers</em> then problems may arise when stopping one of the containers
sharing the volume.  It is suggested that you avoid stopping these containers
at this point until all containers sharing the volumes can be stopped.  This
will enable the unmount process to proceed cleanly.</p>
<h2 id="mesos">Mesos</h2>
<p>In Mesos the frameworks are responsible for receiving requests from
consumers and then proceeding to schedule and manage tasks.  Some frameworks
are open to run any workload for sustained periods of time (ie. Marathon), and
others are use case specific (ie. Cassandra).  Further than this, frameworks can
receive requests from other platforms or schedulers instead of consumers such as
Cloud Foundry, Kubernetes, and Swarm.</p>
<p>Once frameworks decide to accept resource offers from Mesos, tasks are launched
to support workloads.  These tasks eventually make it down to Mesos agents
to spin up containers.  </p>
<p><code>REX-Ray</code> provides the ability for any agent receiving a task to request
storage be orchestrated for that task.  </p>
<p>There are two primary methods that <code>REX-Ray</code> functions with Mesos.  It is up to
the framework to determine which is most appropriate.  Mesos (0.26) has two
containerizer options for tasks, <code>Docker</code> and <code>Mesos</code>.</p>
<h3 id="docker-containerizer-with-marathon">Docker Containerizer with Marathon</h3>
<p>If the framework uses the Docker containerizer, it is required that both
<code>Docker</code> and <code>REX-Ray</code> are configured ahead of time and working.  It is best to
refer to the <a href="#docker">Docker</a> page for more
information.  Once this is configured across all appropriate agents, the
following is an example of using Marathon to start an application with external
volumes.</p>
<pre><code class="json">{
    &quot;id&quot;: &quot;nginx&quot;,
    &quot;container&quot;: {
        &quot;docker&quot;: {
            &quot;image&quot;: &quot;million12/nginx&quot;,
            &quot;network&quot;: &quot;BRIDGE&quot;,
            &quot;portMappings&quot;: [{
                &quot;containerPort&quot;: 80,
                &quot;hostPort&quot;: 0,
                &quot;protocol&quot;: &quot;tcp&quot;
            }],
            &quot;parameters&quot;: [{
                &quot;key&quot;: &quot;volume-driver&quot;,
                &quot;value&quot;: &quot;rexray&quot;
            }, {
                &quot;key&quot;: &quot;volume&quot;,
                &quot;value&quot;: &quot;nginx-data:/data/www&quot;
            }]
        }
    },
    &quot;cpus&quot;: 0.2,
    &quot;mem&quot;: 32.0,
    &quot;instances&quot;: 1
}
</code></pre>

<h3 id="mesos-containerizer-with-marathon">Mesos Containerizer with Marathon</h3>
<p><code>Mesos 0.23+</code> includes modules that enables extensibility for different
portions the architecture.  The <a href="https://github.com/emccode/dvdcli">dvdcli</a> and
<a href="https://github.com/emccode/mesos-module-dvdi">mesos-module-dvdi</a> projects are
required for this method to enable external volume support with the native
containerizer.</p>
<p>The following is a similar example to the one above.  But here we are specifying
to use the the native containerizer and requesting volumes through The <code>env</code>
section.</p>
<pre><code class="json">{
  &quot;id&quot;: &quot;hello-play&quot;,
  &quot;cmd&quot;: &quot;while [ true ] ; do touch /var/lib/rexray/volumes/test12345/hello ; sleep 5 ; done&quot;,
  &quot;mem&quot;: 32,
  &quot;cpus&quot;: 0.1,
  &quot;instances&quot;: 1,
  &quot;env&quot;: {
    &quot;DVDI_VOLUME_NAME&quot;: &quot;test12345&quot;,
    &quot;DVDI_VOLUME_DRIVER&quot;: &quot;rexray&quot;,
    &quot;DVDI_VOLUME_OPTS&quot;: &quot;size=5,iops=150,volumetype=io1,newfstype=xfs,overwritefs=true&quot;
  }
}
</code></pre>

<p>This example also comes along with a couple of important settings for the
native method.  This is a <code>config.yml</code> file that can be used.  In this case we
are showing a <code>virtualbox</code> driver configuration, but you can use anything here.<br />
We suggest two optional options for the <code>mesos-module-dvdi</code>.  Setting the
<code>volume.mount.preempt</code> flag ensures any host can preempt control of a volume
from other hosts.  Refer to the <a href="../../user-guide/config#preemption">User-Guide</a> for
more information on preempt.  The <code>volume.unmount.ignoreusedcount</code> ensures that
<code>mesos-module-dvdi</code> is authoritative when it comes to deciding when to unmount
volumes.</p>
<pre><code class="yaml">rexray:
  storageDrivers:
  - virtualbox
  volume:
    mount:
      preempt: true
    unmount:
      ignoreusedcount: true
virtualbox:
  endpoint: http://yourlaptop:18083
  volumePath: /Users/youruser/VirtualBox Volumes
  controllerName: SATA
</code></pre></div>
        </div>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <!--
        <script src="../../.themes/yeti/js/base.js"></script>
        <script src="../../.themes/yeti/js/bootstrap-3.0.3.min.js"></script>
        <script src="../../.themes/yeti/js/highlight.pack.js"></script>
        <script src="../../.themes/yeti/js/jquery-1.10.2.min.js"></script>
        -->
    </body>

</html>